language: cpp

matrix:
    include:
        - os: osx
          compiler: clang
          osx_image: xcode9.2
        - os: linux
          compiler: gcc

git:
    depth: 1 # Limit unneeded commit depth
    submodules: false

before_install:
    - set -o pipefail
    - git submodule update --init --recursive

install:
    - |
        if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
            brew update
            brew install qt
            brew install lcov
            PATH=/usr/local/opt/qt/bin:${PATH}
        fi
    - |
        if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then
            sudo apt update
            sudo apt install qt5-default
            sudo apt install lcov 
        fi

before_script:
    - mkdir build
    - cd build
    - cmake ..
    - cd ..

script:
    - ./test

after_success:
    - bash <(curl -s https://codecov.io/bash) -X gcov || echo "Codecov did not collect coverage reports" # Collect coverage data
    - curl https://raw.githubusercontent.com/symboxtra/travis-ci-discord-webhook/master/send.sh > send.sh && chmod +x send.sh
    - ./send.sh success $WEBHOOK_URL # Webhook to Discord

after_failure:
    - curl https://raw.githubusercontent.com/symboxtra/travis-ci-discord-webhook/master/send.sh > send.sh && chmod +x send.sh
    - ./send.sh failure $WEBHOOK_URL # Webhook to Discord
